<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Spritrechner</title>

    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#000000">
    <meta name="color-scheme" content="light">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="icon-192.png">

    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('sw.js')
            .catch(err => console.log('SW Fehler:', err));
        });
      }
    </script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        html {
            background-color: #000000 !important;
            height: 100%;
        }
        
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
        }
        
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        @media (max-width: 640px) {
            .difference-stacked > input {
                text-align: center !important;
            }
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-start justify-center min-h-screen p-4 pt-10">

    <div class="bg-gray-800 rounded-2xl shadow-2xl w-full max-w-md p-4 space-y-4 border-2 border-gray-700">
        
        <div class="text-center">
            <h1 class="text-2xl font-bold text-white">Spritrechner</h1>
        </div>

        <div class="bg-gray-900 border border-gray-700 p-3 rounded-lg space-y-2">
            <label for="kmInput" class="text-xs font-bold text-gray-400 uppercase">Gefahrene Strecke</label>
            <input type="text" id="kmInput" inputmode="decimal" class="w-full p-2 text-lg rounded-md bg-gray-700 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-colors" placeholder="Kilometer (km)">
        </div>

        <div class="grid grid-cols-2 gap-4">
            <div class="bg-gray-900 border border-gray-700 p-3 rounded-lg space-y-3">
                <h2 class="text-lg font-bold text-blue-400 text-center">Verbrenner</h2>
                <div>
                    <label for="fuelConsumption" class="block text-xs font-medium text-gray-400 mb-1">Verbrauch (l / 100 km)</label>
                    <input type="text" id="fuelConsumption" inputmode="decimal" class="w-full p-2 rounded-md bg-gray-700 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors" placeholder="z.B. 9,0">
                </div>
                <div>
                    <label for="fuelPrice" class="block text-xs font-medium text-gray-400 mb-1">Preis (€ / l)</label>
                    <input type="text" id="fuelPrice" inputmode="decimal" class="w-full p-2 rounded-md bg-gray-700 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors" placeholder="z.B. 1,60">
                </div>
                <div>
                    <label for="euroOutput" class="block text-xs font-medium text-gray-400 mb-1">Geschätzte Kosten</label>
                    <input type="text" id="euroOutput" readonly class="w-full p-2 rounded-md bg-gray-600 text-white font-bold cursor-not-allowed" placeholder="0,00 €">
                </div>
            </div>

            <div class="bg-gray-900 border border-gray-700 p-3 rounded-lg space-y-3">
                <h2 class="text-lg font-bold text-green-400 text-center">Elektro</h2>
                <div>
                    <label for="kwhConsumption" class="block text-xs font-medium text-gray-400 mb-1">Verbrauch (kWh / 100 km)</label>
                    <input type="text" id="kwhConsumption" inputmode="decimal" class="w-full p-2 rounded-md bg-gray-700 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors" placeholder="z.B. 30,0">
                </div>
                <div>
                    <label for="kwhPrice" class="block text-xs font-medium text-gray-400 mb-1">Preis (€ / kWh)</label>
                    <input type="text" id="kwhPrice" inputmode="decimal" class="w-full p-2 rounded-md bg-gray-700 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-green-500 transition-colors" placeholder="z.B. 0,36">
                </div>
                <div>
                    <label for="euroOutputEv" class="block text-xs font-medium text-gray-400 mb-1">Geschätzte Kosten</label>
                    <input type="text" id="euroOutputEv" readonly class="w-full p-2 rounded-md bg-gray-600 text-white font-bold cursor-not-allowed" placeholder="0,00 €">
                </div>
            </div>
        </div>

        <div class="bg-gray-900 border border-gray-700 p-3 rounded-lg space-y-2 difference-stacked">
            <p id="differenceHeading" class="text-sm font-bold text-yellow-400 uppercase text-center block mb-1">Differenz</p>
            <input type="text" id="differenceOutput" readonly class="w-full p-2 text-xl text-center rounded-md bg-black text-white font-bold cursor-not-allowed transition-colors" placeholder="Ersparnis wird berechnet...">
        </div>
    </div>

    <script>
        const kmInput = document.getElementById('kmInput');
        const fuelConsumptionInput = document.getElementById('fuelConsumption');
        const fuelPriceInput = document.getElementById('fuelPrice');
        const euroOutput = document.getElementById('euroOutput');
        const kwhConsumptionInput = document.getElementById('kwhConsumption');
        const kwhPriceInput = document.getElementById('kwhPrice');
        const euroOutputEv = document.getElementById('euroOutputEv');
        const differenceOutput = document.getElementById('differenceOutput');
        const differenceHeading = document.getElementById('differenceHeading');

        const DEFAULT_FUEL_CONSUMPTION = 9.0;
        const DEFAULT_FUEL_PRICE = 1.60;
        const DEFAULT_KWH_CONSUMPTION = 30.0;
        const DEFAULT_KWH_PRICE = 0.36;
        
        document.addEventListener('DOMContentLoaded', () => {
            loadDataFromLocalStorage();
            addEventListeners();
            calculateAll();
        });

        function parseGermanFloat(str) {
            if (typeof str !== 'string' || str.trim() === '') return NaN;
            return parseFloat(str.replace(',', '.'));
        }

        function formatToGermanString(num, decimals) {
            if (typeof num !== 'number' || isNaN(num)) return '';
            return num.toFixed(decimals).replace('.', ',');
        }

        function addEventListeners() {
            [kmInput, fuelConsumptionInput, fuelPriceInput, kwhConsumptionInput, kwhPriceInput].forEach(el => {
                el.addEventListener('input', calculateAndSave);
            });
            
            fuelConsumptionInput.addEventListener('blur', (e) => formatNumericInput(e, 1));
            kwhConsumptionInput.addEventListener('blur', (e) => formatNumericInput(e, 1));
            fuelPriceInput.addEventListener('blur', (e) => formatNumericInput(e, 2));
            kwhPriceInput.addEventListener('blur', (e) => formatNumericInput(e, 2));
            kmInput.addEventListener('blur', (e) => formatNumericInput(e, 2));
        }

        function loadDataFromLocalStorage() {
            try {
                const savedData = localStorage.getItem('fuelCalculatorSettings');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    fuelConsumptionInput.value = formatToGermanString(data.fuelConsumption || DEFAULT_FUEL_CONSUMPTION, 1);
                    fuelPriceInput.value = formatToGermanString(data.fuelPrice || DEFAULT_FUEL_PRICE, 2);
                    kwhConsumptionInput.value = formatToGermanString(data.kwhConsumption || DEFAULT_KWH_CONSUMPTION, 1);
                    kwhPriceInput.value = formatToGermanString(data.kwhPrice || DEFAULT_KWH_PRICE, 2);
                    kmInput.value = formatToGermanString(data.km || '', 2);
                } else {
                    setAllDefaults();
                }
            } catch (error) {
                setAllDefaults();
            }
        }
        
        function setAllDefaults() {
            fuelConsumptionInput.value = formatToGermanString(DEFAULT_FUEL_CONSUMPTION, 1);
            fuelPriceInput.value = formatToGermanString(DEFAULT_FUEL_PRICE, 2);
            kwhConsumptionInput.value = formatToGermanString(DEFAULT_KWH_CONSUMPTION, 1);
            kwhPriceInput.value = formatToGermanString(DEFAULT_KWH_PRICE, 2);
        }

        function formatNumericInput(event, decimals) {
            const input = event.target;
            const value = parseGermanFloat(input.value);
            if (!isNaN(value)) {
                const formattedValue = formatToGermanString(value, decimals);
                if (input.value && input.value !== formattedValue) {
                    input.value = formattedValue;
                    calculateAndSave();
                }
            }
        }

        function saveDataToLocalStorage() {
            try {
                const dataToSave = {
                    km: parseGermanFloat(kmInput.value) || null,
                    fuelConsumption: parseGermanFloat(fuelConsumptionInput.value) || null,
                    fuelPrice: parseGermanFloat(fuelPriceInput.value) || null,
                    kwhConsumption: parseGermanFloat(kwhConsumptionInput.value) || null,
                    kwhPrice: parseGermanFloat(kwhPriceInput.value) || null,
                };
                localStorage.setItem('fuelCalculatorSettings', JSON.stringify(dataToSave));
            } catch (error) {}
        }

        function calculateGas() {
            const kmValue = parseGermanFloat(kmInput.value);
            const fuelConsumption = parseGermanFloat(fuelConsumptionInput.value);
            const fuelPrice = parseGermanFloat(fuelPriceInput.value);
            if (!isNaN(kmValue) && !isNaN(fuelConsumption) && !isNaN(fuelPrice) && fuelConsumption > 0 && fuelPrice > 0) {
                euroOutput.value = formatToGermanString((kmValue / 100) * fuelConsumption * fuelPrice, 2) + " €";
            } else { euroOutput.value = ''; }
        }
        
        function calculateEv() {
            const kmValue = parseGermanFloat(kmInput.value);
            const kwhConsumption = parseGermanFloat(kwhConsumptionInput.value);
            const kwhPrice = parseGermanFloat(kwhPriceInput.value);
            if (!isNaN(kmValue) && !isNaN(kwhConsumption) && !isNaN(kwhPrice) && kwhConsumption > 0 && kwhPrice > 0) {
                euroOutputEv.value = formatToGermanString((kmValue / 100) * kwhConsumption * kwhPrice, 2) + " €";
            } else { euroOutputEv.value = ''; }
        }

        function calculateDifference() {
            const costGas = parseGermanFloat(euroOutput.value.replace('€', '').trim());
            const costEv = parseGermanFloat(euroOutputEv.value.replace('€', '').trim());

            differenceOutput.classList.remove('text-green-400', 'text-blue-400', 'text-white');
            differenceHeading.classList.remove('text-green-400', 'text-blue-400', 'text-yellow-400');
            differenceHeading.textContent = 'Differenz';
            differenceHeading.classList.add('text-yellow-400');

            if (!isNaN(costGas) && !isNaN(costEv)) {
                const diff = Math.abs(costGas - costEv);
                const higherCost = Math.max(costGas, costEv);
                let percentageText = higherCost > 0 && diff > 0 ? ` (${formatToGermanString((diff / higherCost) * 100, 1)}%)` : '';
                let textClass = costGas < costEv ? 'text-blue-400' : (costEv < costGas ? 'text-green-400' : 'text-white');
                
                differenceHeading.textContent = costGas < costEv ? 'Ersparnis Verbrenner' : (costEv < costGas ? 'Ersparnis Elektro' : 'Kein Kostenunterschied');
                differenceHeading.classList.replace('text-yellow-400', textClass);
                differenceOutput.value = formatToGermanString(diff, 2) + ' €' + percentageText;
                differenceOutput.classList.add(textClass);
            } else {
                differenceOutput.value = '0,00 €';
                differenceOutput.classList.add('text-white');
            }
        }
        
        function calculateAll() { calculateGas(); calculateEv(); calculateDifference(); }
        function calculateAndSave() { calculateAll(); saveDataToLocalStorage(); }
    </script>
</body>
</html>


