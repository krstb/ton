<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ton</title>

    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="icon-192.png">
    
    <meta name="theme-color" content="#ffffff">
    <meta name="color-scheme" content="light">
    <meta name="mobile-web-app-capable" content="yes">
    
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="apple-touch-icon" href="icon-192.png">

    <script>
      // Service Worker Registrierung
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('sw.js')
            .catch(err => console.log('SW Fehler:', err));
        });
      }
    </script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap'); 
       
        /* Fix für PWA-Ränder */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #ffffff; /* Startet mit Weiß passend zum Splash-Screen */
        }

        body {
            font-family: 'Inter', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: background-color 0.5s ease;
        }

        .btn-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            width: 90%;
            max-width: 400px;
        }

        .btn {
            @apply flex flex-col items-center justify-center p-6 rounded-2xl shadow-lg transition-all active:scale-95 text-white font-bold;
        }

        #message {
            position: fixed;
            top: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 1rem 2rem;
            border-radius: 1rem;
            display: none;
            z-index: 50;
        }
    </style>
</head>
<body class="bg-white">

    <div id="message"></div>

    <h1 class="text-2xl font-bold mb-8 text-gray-800">Testton & Farbe</h1>

    <div class="btn-container">
        <button id="colorChanger" class="btn bg-blue-500 hover:bg-blue-600">
            <span>Farbe</span>
        </button>
        <button id="highTone" class="btn bg-green-500 hover:bg-green-600">
            <span>Hoch</span>
        </button>
        <button id="lowTone" class="btn bg-orange-500 hover:bg-orange-600">
            <span>Tief</span>
        </button>
        <button id="alternatingTone" class="btn bg-purple-500 hover:bg-purple-600">
            <span>Mix</span>
        </button>
    </div>

    <div class="mt-10 w-64">
        <label for="volume" class="block text-sm font-medium text-gray-700 mb-2">Lautstärke</label>
        <input type="range" id="volume" min="0" max="1" step="0.01" value="0.5" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-500">
    </div>

    <script>
        const body = document.body;
        const colorChangerBtn = document.getElementById('colorChanger');
        const highToneBtn = document.getElementById('highTone');
        const lowToneBtn = document.getElementById('lowTone');
        const alternatingToneBtn = document.getElementById('alternatingTone');
        const volumeSlider = document.getElementById('volume');
        const messageBox = document.getElementById('message');

        let colorClickCount = 0;
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const masterGainNode = audioCtx.createGain();
        masterGainNode.connect(audioCtx.destination);
        masterGainNode.gain.value = 0.5;

        function getRandomColor() {
            const letters = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }

        function showMessage(text) {
            messageBox.textContent = text;
            messageBox.style.display = 'block';
        }

        function hideMessage() {
            messageBox.style.display = 'none';
        }

        function playTone(freq, isSquare) {
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();

            osc.type = isSquare ? 'square' : 'sine';
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            
            gain.gain.setValueAtTime(0, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(1, audioCtx.currentTime + 0.05);
            gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.3);

            osc.connect(gain);
            gain.connect(masterGainNode);

            osc.start();
            osc.stop(audioCtx.currentTime + 0.3);
        }

        function playToneThrice(freq, isSquare) {
            playTone(freq, isSquare);
            setTimeout(() => playTone(freq, isSquare), 400);
            setTimeout(() => playTone(freq, isSquare), 800);
        }

        function playAlternatingSequence() {
            playTone(880, false);
            setTimeout(() => playTone(880, false), 400);
            setTimeout(() => playTone(880, false), 800);

            setTimeout(() => {
                playTone(330, true);
                setTimeout(() => playTone(330, true), 400);
                setTimeout(() => playTone(330, true), 800);
            }, 1200);
        }
        
        colorChangerBtn.addEventListener('click', () => {
            body.style.backgroundColor = getRandomColor();
            colorClickCount++;
            if (colorClickCount % 5 === 0) {
                showMessage("Du hast die Farbe 5 mal geändert. Die nächste Farbe ist rot!");
                setTimeout(() => {
                    body.style.backgroundColor = '#ef4444';
                }, 1000);
            } else {
                hideMessage();
            }
        });
        
        highToneBtn.addEventListener('click', () => {
            playToneThrice(880, false);
        });

        lowToneBtn.addEventListener('click', () => {
            playToneThrice(330, true);
        });
        
        alternatingToneBtn.addEventListener('click', () => {
            playAlternatingSequence();
        });
        
        volumeSlider.addEventListener('input', (event) => {
            masterGainNode.gain.value = event.target.value;
        });
    </script>
</body>
</html>
